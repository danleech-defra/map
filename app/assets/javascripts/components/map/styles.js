'use strict'
/*
Sets up the window.flood.maps styles objects
*/
import { Style, Icon, Fill, Stroke } from 'ol/style'

window.flood.maps.styles = {
  // Primarily vector tiles
  nuts1: (feature) => {
    // Generate style
    const style = new Style({
      fill: new Fill({
        color: '#f3f2f1'
      }),
      stroke: new Stroke({
        color: '#f3f2f1',
        width: 0
      })
    })

    return style
  },

  // Primarily vector tiles
  targetAreaPolygons: (feature) => {
    // Use corresposnding warning feature propeties for styling
    const warningsSource = window.flood.maps.warningsSource
    const warning = warningsSource.getFeatureById(feature.getId())
    if (!warning || !warning.get('isActive')) {
      return new Style()
    }

    const state = warning.get('state')
    const isSelected = warning.get('isSelected')
    const isGroundwater = warning.getId().substring(6, 9) === 'FAG'

    // Defaults
    let strokeColour = 'transparent'
    let fillColour = 'transparent'
    let zIndex = 1

    switch (state) {
      case 11: // Severe warning
        strokeColour = isSelected ? '#626a6e' : '#0b0c0c'
        fillColour = pattern('severe', isSelected)
        zIndex = 5
        break
      case 12: // Warning
        strokeColour = isSelected ? '#626a6e' : '#0b0c0c'
        fillColour = pattern('warning', isSelected)
        zIndex = 4
        break
      case 13: // Alert
        strokeColour = isSelected ? '#626a6e' : '#0b0c0c'
        fillColour = pattern('alert', isSelected)
        zIndex = isGroundwater ? 1 : 2
        break
      case 14: // Removed
        strokeColour = isSelected ? '#626a6e' : '#0b0c0c'
        fillColour = pattern('removed', isSelected)
        zIndex = 3
        break
    }

    // Generate style
    const style = new Style({
      fill: new Fill({
        color: fillColour
      }),
      stroke: new Stroke({
        color: strokeColour,
        width: 1,
        miterLimit: 2,
        lineJoin: 'round',
        lineDash: [0, 0]
      }),
      zIndex: zIndex
    })

    return style
  },

  // Warning centroids
  warnings: (feature, resolution) => {
    // If warning type is hidden in the key
    if (!feature.get('isActive')) {
      return new Style({})
    }
    // Hide warning symbols when polygon is shown
    if (resolution < window.flood.maps.symbolThreshold) {
      return new Style({})
    }

    const state = feature.get('state')
    const isSelected = feature.get('isSelected')
    const dataUri = {
      severe: 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="46" height="46" viewBox="0 0 35 35"%3E%3Cpath d="M7.406,28.494c-0.776,0 -1.406,-0.63 -1.406,-1.407c0,-0.226 0.053,-0.439 0.148,-0.629l9.844,-19.687c0.231,-0.46 0.708,-0.777 1.258,-0.777c0.55,0 1.027,0.317 1.258,0.777l9.844,19.687c0.095,0.19 0.148,0.403 0.148,0.629c0,0.777 -0.63,1.407 -1.406,1.407l-19.688,0Z"/%3E%3Cpath d="M9.353,25.08c0.721,0.153 1.503,-0.047 2.063,-0.603c0.146,-0.145 0.383,-0.145 0.529,0c0.876,0.87 2.299,0.87 3.176,0c0.146,-0.145 0.383,-0.145 0.529,0c0.409,0.406 0.937,0.623 1.473,0.65l0,-0.001c0.038,0.002 0.076,0.003 0.115,0.004c0.046,0 0.093,-0.002 0.139,-0.005l0,0.001c0.531,-0.031 1.052,-0.247 1.456,-0.649c0.146,-0.145 0.384,-0.145 0.53,0c0.876,0.87 2.299,0.87 3.175,0c0.146,-0.145 0.384,-0.145 0.53,0c0.563,0.559 1.352,0.759 2.077,0.599l0.584,1.168l-16.958,0l0.582,-1.164Z" style="fill:%23fff;"/%3E%3Cpath d="M10.505,22.402c0.333,-0.105 0.647,-0.288 0.911,-0.55c0.146,-0.145 0.383,-0.145 0.529,0c0.876,0.87 2.299,0.87 3.176,0c0.146,-0.145 0.383,-0.145 0.529,0c0.409,0.406 0.937,0.623 1.473,0.65l0,-0.001c0.038,0.002 0.076,0.003 0.115,0.004c0.046,0 0.093,-0.002 0.139,-0.005l0,0.001c0.531,-0.031 1.052,-0.247 1.456,-0.649c0.146,-0.145 0.384,-0.145 0.53,0c0.876,0.87 2.299,0.87 3.175,0c0.146,-0.145 0.384,-0.145 0.53,0c0.269,0.268 0.59,0.453 0.93,0.556l0.606,1.21c-0.558,-0.013 -1.111,-0.23 -1.536,-0.652c-0.146,-0.144 -0.384,-0.144 -0.53,0c-0.876,0.87 -2.299,0.87 -3.175,0c-0.146,-0.144 -0.384,-0.144 -0.53,0c-0.439,0.437 -1.016,0.654 -1.593,0.653c-0.576,0 -1.151,-0.217 -1.59,-0.653c-0.146,-0.144 -0.383,-0.144 -0.529,0c-0.877,0.87 -2.3,0.87 -3.176,0c-0.146,-0.144 -0.383,-0.144 -0.529,0c-0.421,0.418 -0.968,0.635 -1.519,0.652l0.608,-1.216Z" style="fill:%23fff;"/%3E%3Cpath d="M11.917,19.202c0.01,0.008 0.019,0.016 0.028,0.025c0.876,0.87 2.299,0.87 3.176,0c0.146,-0.145 0.383,-0.145 0.529,0c0.409,0.406 0.937,0.623 1.473,0.65l0,-0.001c0.038,0.002 0.076,0.003 0.115,0.004c0.046,0 0.093,-0.002 0.139,-0.005l0,0.001c0.531,-0.031 1.052,-0.247 1.456,-0.649c0.146,-0.145 0.384,-0.145 0.53,0c0.876,0.87 2.299,0.87 3.175,0c0.013,-0.012 0.026,-0.024 0.04,-0.034l0.645,1.289c-0.053,-0.044 -0.105,-0.091 -0.155,-0.141c-0.146,-0.144 -0.384,-0.144 -0.53,0c-0.876,0.87 -2.299,0.87 -3.175,0c-0.146,-0.144 -0.384,-0.144 -0.53,0c-0.439,0.437 -1.016,0.654 -1.593,0.653c-0.576,0 -1.151,-0.217 -1.59,-0.653c-0.146,-0.144 -0.383,-0.144 -0.529,0c-0.877,0.87 -2.3,0.87 -3.176,0c-0.146,-0.144 -0.383,-0.144 -0.529,0c-0.041,0.041 -0.084,0.08 -0.127,0.117l0.628,-1.256Z" style="fill:%23fff;"/%3E%3Cpath d="M20.566,16.497l-0.784,0l0,1.115l-5.078,-0.002l0,-1.113l-0.77,0l1.265,-1.403l0,-1.47l0.761,0l0,0.596l1.281,-1.473l3.325,3.75Z" style="fill:%23fff;fill-rule:nonzero;"/%3E%3C/svg%3E',
      severeSelected: 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="46" height="46" viewBox="0 0 35 35"%3E%3Cg%3E%3Cg%3E%3Cpath d="M7.405,28.487c-0.775,0 -1.405,-0.629 -1.405,-1.405c0,-0.226 0.053,-0.44 0.148,-0.629l9.838,-19.676c0.232,-0.46 0.708,-0.777 1.258,-0.777c0.55,0 1.026,0.317 1.257,0.777l9.838,19.676c0.095,0.189 0.148,0.403 0.148,0.629c0,0.776 -0.629,1.405 -1.405,1.405l-19.677,0" style="fill:%23fd0;fill-rule:nonzero;stroke:%23fd0;stroke-width:12px;"/%3E%3Cpath d="M7.394,28.487c-0.777,0 -1.407,-0.63 -1.407,-1.406c0,-0.226 0.054,-0.44 0.148,-0.629l9.844,-19.687c0.232,-0.461 0.708,-0.778 1.258,-0.778c0.551,0 1.027,0.317 1.258,0.778l9.844,19.687c0.095,0.189 0.148,0.403 0.148,0.629c0,0.776 -0.63,1.406 -1.406,1.406l-19.687,0Z" style="fill:none;stroke:%23000;stroke-width:3px;"/%3E%3C/g%3E%3C/g%3E%3Cpath d="M7.394,28.487c-0.777,0 -1.407,-0.63 -1.407,-1.406c0,-0.226 0.054,-0.44 0.148,-0.629l9.844,-19.687c0.232,-0.461 0.708,-0.778 1.258,-0.778c0.551,0 1.027,0.317 1.258,0.778l9.844,19.687c0.095,0.189 0.148,0.403 0.148,0.629c0,0.776 -0.63,1.406 -1.406,1.406l-19.687,0Z"/%3E%3Cpath d="M9.34,25.073c0.721,0.154 1.504,-0.047 2.063,-0.602c0.146,-0.145 0.383,-0.145 0.529,0c0.877,0.87 2.3,0.87 3.176,0c0.146,-0.145 0.383,-0.145 0.529,0c0.409,0.406 0.937,0.622 1.473,0.649l0,0c0.038,0.002 0.077,0.003 0.115,0.003c0.047,0 0.093,-0.001 0.14,-0.004l0,0c0.53,-0.03 1.051,-0.246 1.456,-0.648c0.146,-0.145 0.383,-0.145 0.529,0c0.876,0.87 2.299,0.87 3.176,0c0.146,-0.145 0.383,-0.145 0.529,0c0.563,0.559 1.353,0.759 2.078,0.599l0.583,1.167l-16.958,0l0.582,-1.164Z" style="fill:%23fff;"/%3E%3Cpath d="M10.492,22.395c0.333,-0.104 0.647,-0.287 0.911,-0.549c0.146,-0.145 0.383,-0.145 0.529,0c0.877,0.87 2.3,0.87 3.176,0c0.146,-0.145 0.383,-0.145 0.529,0c0.409,0.406 0.937,0.622 1.473,0.649l0,0c0.038,0.002 0.077,0.003 0.115,0.003c0.047,0 0.093,-0.001 0.14,-0.004l0,0c0.53,-0.03 1.051,-0.246 1.456,-0.648c0.146,-0.145 0.383,-0.145 0.529,0c0.876,0.87 2.299,0.87 3.176,0c0.146,-0.145 0.383,-0.145 0.529,0c0.269,0.267 0.59,0.452 0.931,0.555l0.605,1.211c-0.557,-0.013 -1.111,-0.23 -1.536,-0.652c-0.146,-0.145 -0.383,-0.145 -0.529,0c-0.877,0.87 -2.3,0.87 -3.176,0c-0.146,-0.145 -0.383,-0.145 -0.529,0c-0.44,0.436 -1.017,0.654 -1.594,0.652c-0.575,0.001 -1.151,-0.217 -1.59,-0.652c-0.146,-0.145 -0.383,-0.145 -0.529,0c-0.876,0.87 -2.299,0.87 -3.176,0c-0.146,-0.145 -0.383,-0.145 -0.529,0c-0.421,0.418 -0.967,0.635 -1.519,0.651l0.608,-1.216Z" style="fill:%23fff;"/%3E%3Cpath d="M11.904,19.196c0.01,0.008 0.019,0.016 0.028,0.025c0.877,0.87 2.3,0.87 3.176,0c0.146,-0.145 0.383,-0.145 0.529,0c0.409,0.406 0.937,0.622 1.473,0.649l0,0c0.038,0.002 0.077,0.003 0.115,0.003c0.047,0 0.093,-0.001 0.14,-0.004l0,0c0.53,-0.03 1.051,-0.246 1.456,-0.648c0.146,-0.145 0.383,-0.145 0.529,0c0.876,0.87 2.299,0.87 3.176,0c0.012,-0.013 0.026,-0.024 0.04,-0.035l0.645,1.29c-0.054,-0.044 -0.106,-0.091 -0.156,-0.141c-0.146,-0.145 -0.383,-0.145 -0.529,0c-0.877,0.87 -2.3,0.87 -3.176,0c-0.146,-0.145 -0.383,-0.145 -0.529,0c-0.44,0.436 -1.017,0.654 -1.594,0.652c-0.575,0.001 -1.151,-0.217 -1.59,-0.652c-0.146,-0.145 -0.383,-0.145 -0.529,0c-0.876,0.87 -2.299,0.87 -3.176,0c-0.146,-0.145 -0.383,-0.145 -0.529,0c-0.041,0.041 -0.083,0.08 -0.127,0.117l0.628,-1.256Z" style="fill:%23fff;"/%3E%3Cpath d="M20.553,16.49l-0.784,0l0,1.116l-5.078,-0.002l0,-1.114l-0.769,0l1.264,-1.402l0,-1.47l0.761,0l0,0.595l1.281,-1.473l3.325,3.75Z" style="fill:%23fff;fill-rule:nonzero;"/%3E%3C/svg%3E',
      warning: 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="46" height="46" viewBox="0 0 35 35"%3E%3Cpath d="M7.406,28.494c-0.776,0 -1.406,-0.63 -1.406,-1.407c0,-0.226 0.053,-0.439 0.148,-0.629l9.844,-19.687c0.231,-0.46 0.708,-0.777 1.258,-0.777c0.55,0 1.027,0.317 1.258,0.777l9.844,19.687c0.095,0.19 0.148,0.403 0.148,0.629c0,0.777 -0.63,1.407 -1.406,1.407l-19.688,0Z"/%3E%3Cpath d="M9.353,25.08c0.721,0.153 1.503,-0.047 2.063,-0.603c0.146,-0.145 0.383,-0.145 0.529,0c0.876,0.87 2.299,0.87 3.176,0c0.146,-0.145 0.383,-0.145 0.529,0c0.409,0.406 0.937,0.623 1.473,0.65l0,-0.001c0.038,0.002 0.076,0.003 0.115,0.004c0.046,0 0.093,-0.002 0.139,-0.005l0,0.001c0.531,-0.031 1.052,-0.247 1.456,-0.649c0.146,-0.145 0.384,-0.145 0.53,0c0.876,0.87 2.299,0.87 3.175,0c0.146,-0.145 0.384,-0.145 0.53,0c0.563,0.559 1.352,0.759 2.077,0.599l0.584,1.168l-16.958,0l0.582,-1.164Z" style="fill:%23fff;"/%3E%3Cpath d="M10.505,22.402c0.333,-0.105 0.647,-0.288 0.911,-0.55c0.146,-0.145 0.383,-0.145 0.529,0c0.876,0.87 2.299,0.87 3.176,0c0.146,-0.145 0.383,-0.145 0.529,0c0.409,0.406 0.937,0.623 1.473,0.65l0,-0.001c0.038,0.002 0.076,0.003 0.115,0.004c0.046,0 0.093,-0.002 0.139,-0.005l0,0.001c0.531,-0.031 1.052,-0.247 1.456,-0.649c0.146,-0.145 0.384,-0.145 0.53,0c0.876,0.87 2.299,0.87 3.175,0c0.146,-0.145 0.384,-0.145 0.53,0c0.269,0.268 0.59,0.453 0.93,0.556l0.606,1.21c-0.558,-0.013 -1.111,-0.23 -1.536,-0.652c-0.146,-0.144 -0.384,-0.144 -0.53,0c-0.876,0.87 -2.299,0.87 -3.175,0c-0.146,-0.144 -0.384,-0.144 -0.53,0c-0.439,0.437 -1.016,0.654 -1.593,0.653c-0.576,0 -1.151,-0.217 -1.59,-0.653c-0.146,-0.144 -0.383,-0.144 -0.529,0c-0.877,0.87 -2.3,0.87 -3.176,0c-0.146,-0.144 -0.383,-0.144 -0.529,0c-0.421,0.418 -0.968,0.635 -1.519,0.652l0.608,-1.216Z" style="fill:%23fff;"/%3E%3Cpath d="M20.566,16.905l-0.784,0l0,3.012l-5.078,-0.002l0,-3.01l-0.77,0l1.265,-1.402l0,-1.47l0.761,0l0,0.595l1.281,-1.473l3.325,3.75Z" style="fill:%23fff;fill-rule:nonzero;"/%3E%3C/svg%3E',
      warningSelected: 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="46" height="46" viewBox="0 0 35 35"%3E%3Cg%3E%3Cg%3E%3Cpath d="M7.405,28.487c-0.775,0 -1.405,-0.629 -1.405,-1.405c0,-0.226 0.053,-0.44 0.148,-0.629l9.838,-19.676c0.232,-0.46 0.708,-0.777 1.258,-0.777c0.55,0 1.026,0.317 1.257,0.777l9.838,19.676c0.095,0.189 0.148,0.403 0.148,0.629c0,0.776 -0.629,1.405 -1.405,1.405l-19.677,0" style="fill:%23fd0;fill-rule:nonzero;stroke:%23fd0;stroke-width:12px;"/%3E%3Cpath d="M7.394,28.487c-0.777,0 -1.407,-0.63 -1.407,-1.406c0,-0.226 0.054,-0.44 0.148,-0.629l9.844,-19.687c0.232,-0.461 0.708,-0.778 1.258,-0.778c0.551,0 1.027,0.317 1.258,0.778l9.844,19.687c0.095,0.189 0.148,0.403 0.148,0.629c0,0.776 -0.63,1.406 -1.406,1.406l-19.687,0Z" style="fill:none;stroke:%23000;stroke-width:3px;"/%3E%3C/g%3E%3C/g%3E%3Cpath d="M7.406,28.487c-0.776,0 -1.406,-0.63 -1.406,-1.406c0,-0.226 0.053,-0.44 0.148,-0.629l9.844,-19.687c0.231,-0.461 0.708,-0.778 1.258,-0.778c0.55,0 1.027,0.317 1.258,0.778l9.844,19.687c0.095,0.189 0.148,0.403 0.148,0.629c0,0.776 -0.63,1.406 -1.406,1.406l-19.688,0Z"/%3E%3Cpath d="M9.353,25.073c0.721,0.154 1.503,-0.047 2.063,-0.602c0.146,-0.145 0.383,-0.145 0.529,0c0.876,0.87 2.299,0.87 3.176,0c0.146,-0.145 0.383,-0.145 0.529,0c0.409,0.406 0.937,0.622 1.473,0.649l0,0c0.038,0.002 0.076,0.003 0.115,0.003c0.046,0 0.093,-0.001 0.139,-0.004l0,0c0.531,-0.03 1.052,-0.246 1.456,-0.648c0.146,-0.145 0.384,-0.145 0.53,0c0.876,0.87 2.299,0.87 3.175,0c0.146,-0.145 0.384,-0.145 0.53,0c0.563,0.559 1.352,0.759 2.077,0.599l0.584,1.167l-16.958,0l0.582,-1.164Z" style="fill:%23fff;"/%3E%3Cpath d="M10.505,22.395c0.333,-0.104 0.647,-0.287 0.911,-0.549c0.146,-0.145 0.383,-0.145 0.529,0c0.876,0.87 2.299,0.87 3.176,0c0.146,-0.145 0.383,-0.145 0.529,0c0.409,0.406 0.937,0.622 1.473,0.649l0,0c0.038,0.002 0.076,0.003 0.115,0.003c0.046,0 0.093,-0.001 0.139,-0.004l0,0c0.531,-0.03 1.052,-0.246 1.456,-0.648c0.146,-0.145 0.384,-0.145 0.53,0c0.876,0.87 2.299,0.87 3.175,0c0.146,-0.145 0.384,-0.145 0.53,0c0.269,0.267 0.59,0.452 0.93,0.555l0.606,1.211c-0.558,-0.013 -1.111,-0.23 -1.536,-0.652c-0.146,-0.145 -0.384,-0.145 -0.53,0c-0.876,0.87 -2.299,0.87 -3.175,0c-0.146,-0.145 -0.384,-0.145 -0.53,0c-0.439,0.436 -1.016,0.654 -1.593,0.652c-0.576,0.001 -1.151,-0.217 -1.59,-0.652c-0.146,-0.145 -0.383,-0.145 -0.529,0c-0.877,0.87 -2.3,0.87 -3.176,0c-0.146,-0.145 -0.383,-0.145 -0.529,0c-0.421,0.418 -0.968,0.635 -1.519,0.651l0.608,-1.216Z" style="fill:%23fff;"/%3E%3Cpath d="M20.566,16.899l-0.784,0l0,3.011l-5.078,-0.001l0,-3.01l-0.77,0l1.265,-1.403l0,-1.47l0.761,0l0,0.596l1.281,-1.473l3.325,3.75Z" style="fill:%23fff;fill-rule:nonzero;"/%3E%3C/svg%3E',
      alert: 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="46" height="46" viewBox="0 0 35 35"%3E%3Cpath d="M7.394,28.5c-0.777,0 -1.407,-0.63 -1.407,-1.406c0,-0.226 0.054,-0.44 0.148,-0.629l9.844,-19.688c0.232,-0.46 0.708,-0.777 1.258,-0.777c0.551,0 1.027,0.317 1.258,0.777l9.844,19.688c0.095,0.189 0.148,0.403 0.148,0.629c0,0.776 -0.63,1.406 -1.406,1.406l-19.687,0Z" style="fill:%23d4351c;"/%3E%3Cpath d="M7.394,28.5c-0.777,0 -1.407,-0.63 -1.407,-1.406c0,-0.226 0.054,-0.44 0.148,-0.629l9.844,-19.688c0.232,-0.46 0.708,-0.777 1.258,-0.777c0.551,0 1.027,0.317 1.258,0.777l9.844,19.688c0.095,0.189 0.148,0.403 0.148,0.629c0,0.776 -0.63,1.406 -1.406,1.406l-19.687,0Z"/%3E%3Cpath d="M8.152,26.625l18.171,0l-9.086,-18.171c-3.028,6.057 -6.057,12.114 -9.085,18.171Z" style="fill:%23fff;stroke:%23fff;stroke-width:0.08px;"/%3E%3Cpath d="M20.553,18.738l-0.784,0l0,3.012l-5.078,-0.002l0,-3.01l-0.769,0l1.264,-1.402l0,-1.47l0.761,0l0,0.595l1.281,-1.473l3.325,3.75Z" style="fill-rule:nonzero;"/%3E%3Cpath d="M11.495,23.292c0.141,-0.073 0.319,-0.051 0.437,0.067c0.877,0.869 2.3,0.869 3.176,0c0.146,-0.145 0.383,-0.145 0.529,0c0.409,0.405 0.937,0.622 1.473,0.649l0,0c0.038,0.002 0.077,0.003 0.115,0.003c0.047,0 0.093,-0.002 0.14,-0.004l0,0c0.53,-0.031 1.051,-0.247 1.456,-0.648c0.146,-0.145 0.383,-0.145 0.529,0c0.876,0.869 2.299,0.869 3.176,0c0.124,-0.124 0.316,-0.142 0.46,-0.054l0.91,1.82l-13.317,0l0.916,-1.833Z"/%3E%3C/svg%3E',
      alertSelected: 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="46" height="46" viewBox="0 0 35 35"%3E%3Cg%3E%3Cg%3E%3Cg%3E%3Cpath d="M7.405,28.487c-0.775,0 -1.405,-0.629 -1.405,-1.405c0,-0.226 0.053,-0.44 0.148,-0.629l9.838,-19.676c0.232,-0.46 0.708,-0.777 1.258,-0.777c0.55,0 1.026,0.317 1.257,0.777l9.838,19.676c0.095,0.189 0.148,0.403 0.148,0.629c0,0.776 -0.629,1.405 -1.405,1.405l-19.677,0" style="fill:%23fd0;fill-rule:nonzero;stroke:%23fd0;stroke-width:12px;"/%3E%3Cpath d="M7.394,28.487c-0.777,0 -1.407,-0.63 -1.407,-1.406c0,-0.226 0.054,-0.44 0.148,-0.629l9.844,-19.687c0.232,-0.461 0.708,-0.778 1.258,-0.778c0.551,0 1.027,0.317 1.258,0.778l9.844,19.687c0.095,0.189 0.148,0.403 0.148,0.629c0,0.776 -0.63,1.406 -1.406,1.406l-19.687,0Z" style="fill:none;stroke:%23000;stroke-width:3px;"/%3E%3C/g%3E%3C/g%3E%3Cpath d="M7.394,28.513c-0.777,0 -1.407,-0.63 -1.407,-1.407c0,-0.226 0.054,-0.439 0.149,-0.629l9.843,-19.687c0.232,-0.46 0.708,-0.777 1.258,-0.777c0.551,0 1.027,0.317 1.259,0.777l9.843,19.687c0.095,0.19 0.148,0.403 0.148,0.629c0,0.777 -0.63,1.407 -1.406,1.407l-19.687,0Z" style="fill:%23d4351c;"/%3E%3Cpath d="M7.394,28.513c-0.777,0 -1.407,-0.63 -1.407,-1.407c0,-0.226 0.054,-0.439 0.149,-0.629l9.843,-19.687c0.232,-0.46 0.708,-0.777 1.258,-0.777c0.551,0 1.027,0.317 1.259,0.777l9.843,19.687c0.095,0.19 0.148,0.403 0.148,0.629c0,0.777 -0.63,1.407 -1.406,1.407l-19.687,0Z"/%3E%3Cpath d="M8.152,26.638l18.171,0l-9.086,-18.172c-3.028,6.057 -6.057,12.114 -9.085,18.172Z" style="fill:%23fff;stroke:%23fff;stroke-width:0.08px;"/%3E%3Cpath d="M20.553,18.751l-0.784,0l0,3.012l-5.078,-0.002l0,-3.01l-0.769,0l1.264,-1.403l0,-1.47l0.761,0l0,0.596l1.281,-1.473l3.325,3.75Z" style="fill-rule:nonzero;"/%3E%3Cpath d="M11.495,23.304c0.141,-0.072 0.319,-0.05 0.437,0.067c0.877,0.87 2.3,0.87 3.176,0c0.146,-0.145 0.383,-0.145 0.529,0c0.409,0.406 0.937,0.622 1.473,0.65l0,-0.001c0.038,0.002 0.077,0.003 0.115,0.003c0.047,0 0.093,-0.001 0.14,-0.004l0,0.001c0.53,-0.031 1.051,-0.247 1.456,-0.649c0.146,-0.145 0.383,-0.145 0.529,0c0.876,0.87 2.299,0.87 3.176,0c0.124,-0.123 0.316,-0.142 0.46,-0.054l0.91,1.821l-13.317,0l0.916,-1.834Z"/%3E%3C/g%3E%3C/svg%3E',
      removed: 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="46" height="46" viewBox="0 0 35 35"%3E%3Cpath d="M7.406,28.494c-0.776,0 -1.406,-0.63 -1.406,-1.407c0,-0.226 0.053,-0.439 0.148,-0.629l9.844,-19.687c0.231,-0.46 0.708,-0.777 1.258,-0.777c0.55,0 1.027,0.317 1.258,0.777l9.844,19.687c0.095,0.19 0.148,0.403 0.148,0.629c0,0.777 -0.63,1.407 -1.406,1.407l-19.688,0Z" style="fill:%23d4351c;"/%3E%3Cpath d="M7.406,28.494c-0.776,0 -1.406,-0.63 -1.406,-1.407c0,-0.226 0.053,-0.439 0.148,-0.629l9.844,-19.687c0.231,-0.46 0.708,-0.777 1.258,-0.777c0.55,0 1.027,0.317 1.258,0.777l9.844,19.687c0.095,0.19 0.148,0.403 0.148,0.629c0,0.777 -0.63,1.407 -1.406,1.407l-19.688,0Z"/%3E%3Cpath d="M8.164,26.619l18.172,0l-9.086,-18.172c-3.029,6.057 -6.057,12.115 -9.086,18.172Z" style="fill:%23fff;stroke:%23fff;stroke-width:0.08px;"/%3E%3Cpath d="M12.568,21.165c0.834,0.393 1.863,0.247 2.553,-0.438c0.146,-0.145 0.383,-0.145 0.529,0c0.409,0.406 0.937,0.623 1.472,0.65l0,-0.001c0.039,0.002 0.077,0.003 0.116,0.004c0.046,0 0.093,-0.002 0.139,-0.005l0,0.001c0.53,-0.031 1.052,-0.247 1.456,-0.649c0.146,-0.145 0.383,-0.145 0.53,0c0.693,0.689 1.729,0.832 2.565,0.431l0.425,0.848c-0.882,0.701 -2.174,0.646 -2.99,-0.165c-0.147,-0.144 -0.384,-0.144 -0.53,0c-0.439,0.437 -1.017,0.654 -1.593,0.653c-0.576,0 -1.151,-0.217 -1.59,-0.653c-0.146,-0.144 -0.383,-0.144 -0.529,0c-0.814,0.807 -2.097,0.866 -2.978,0.175l0.425,-0.851Z"/%3E%3Cpath d="M11.508,23.285c0.141,-0.072 0.319,-0.05 0.437,0.067c0.876,0.87 2.299,0.87 3.176,0c0.146,-0.145 0.383,-0.145 0.529,0c0.409,0.406 0.937,0.623 1.473,0.65l0,-0.001c0.038,0.002 0.076,0.003 0.115,0.004c0.046,0 0.093,-0.002 0.139,-0.005l0,0.001c0.531,-0.031 1.052,-0.247 1.456,-0.649c0.146,-0.145 0.384,-0.145 0.53,0c0.876,0.87 2.299,0.87 3.175,0c0.125,-0.123 0.316,-0.141 0.46,-0.054l0.911,1.821l-13.318,0l0.917,-1.834Z"/%3E%3C/svg%3E',
      removedSelected: 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="46" height="46" viewBox="0 0 35 35"%3E%3Cg%3E%3Cpath d="M7.405,28.487c-0.775,0 -1.405,-0.629 -1.405,-1.405c0,-0.226 0.053,-0.44 0.148,-0.629l9.838,-19.676c0.232,-0.46 0.708,-0.777 1.258,-0.777c0.55,0 1.026,0.317 1.257,0.777l9.838,19.676c0.095,0.189 0.148,0.403 0.148,0.629c0,0.776 -0.629,1.405 -1.405,1.405l-19.677,0" style="fill:%23fd0;fill-rule:nonzero;stroke:%23fd0;stroke-width:12px;"/%3E%3Cpath d="M7.394,28.487c-0.777,0 -1.407,-0.63 -1.407,-1.406c0,-0.226 0.054,-0.44 0.148,-0.629l9.844,-19.687c0.232,-0.461 0.708,-0.778 1.258,-0.778c0.551,0 1.027,0.317 1.258,0.778l9.844,19.687c0.095,0.189 0.148,0.403 0.148,0.629c0,0.776 -0.63,1.406 -1.406,1.406l-19.687,0Z" style="fill:none;stroke:%23000;stroke-width:3px;"/%3E%3C/g%3E%3Cpath d="M7.394,28.487c-0.777,0 -1.407,-0.63 -1.407,-1.406c0,-0.226 0.054,-0.44 0.148,-0.629l9.844,-19.687c0.232,-0.461 0.708,-0.778 1.258,-0.778c0.551,0 1.027,0.317 1.258,0.778l9.844,19.687c0.095,0.189 0.148,0.403 0.148,0.629c0,0.776 -0.63,1.406 -1.406,1.406l-19.687,0Z"/%3E%3Cg%3E%3Cpath d="M8.152,26.638l18.171,0l-9.086,-18.172c-3.028,6.057 -6.057,12.114 -9.085,18.172Z" style="fill:%23fff;stroke:%23fff;stroke-width:0.08px;"/%3E%3Cpath d="M12.558,21.183c0.834,0.393 1.863,0.248 2.552,-0.437c0.146,-0.145 0.384,-0.145 0.53,0c0.409,0.406 0.936,0.622 1.472,0.65l0,-0.001c0.039,0.002 0.077,0.003 0.116,0.003c0.046,0 0.093,-0.001 0.139,-0.004l0,0.001c0.53,-0.031 1.051,-0.247 1.456,-0.649c0.146,-0.145 0.383,-0.145 0.529,0c0.694,0.689 1.73,0.832 2.566,0.431l0.424,0.848c-0.881,0.701 -2.173,0.646 -2.99,-0.165c-0.146,-0.145 -0.383,-0.145 -0.529,0c-0.44,0.437 -1.017,0.654 -1.593,0.653c-0.576,0 -1.152,-0.217 -1.59,-0.653c-0.146,-0.145 -0.384,-0.145 -0.53,0c-0.813,0.807 -2.097,0.865 -2.978,0.175l0.426,-0.852Z"/%3E%3Cpath d="M11.495,23.304c0.141,-0.072 0.319,-0.05 0.437,0.067c0.877,0.87 2.3,0.87 3.176,0c0.146,-0.145 0.383,-0.145 0.529,0c0.409,0.406 0.937,0.622 1.473,0.65l0,-0.001c0.038,0.002 0.077,0.003 0.115,0.003c0.047,0 0.093,-0.001 0.14,-0.004l0,0.001c0.53,-0.031 1.051,-0.247 1.456,-0.649c0.146,-0.145 0.383,-0.145 0.529,0c0.876,0.87 2.299,0.87 3.176,0c0.124,-0.123 0.316,-0.142 0.46,-0.054l0.91,1.821l-13.317,0l0.916,-1.834Z"/%3E%3C/g%3E%3C/svg%3E'
    }
    let source = ''

    // Defaults
    let zIndex = 1

    switch (state) {
      case 11: // Severe warning
        zIndex = 10
        source = isSelected ? dataUri.severeSelected : dataUri.severe
        break
      case 12: // Warning
        zIndex = 9
        source = isSelected ? dataUri.warningSelected : dataUri.warning
        break
      case 13: // Alert
        zIndex = 7
        source = isSelected ? dataUri.alertSelected : dataUri.alert
        break
      case 14: // Removed
        zIndex = 8
        source = isSelected ? dataUri.removedSelected : dataUri.removed
        break
    }

    const style = new Style({
      image: new Icon({
        src: source,
        size: [46, 46],
        anchor: [0.5, 0.5],
        scale: 1
      }),
      zIndex: zIndex
    })

    return style
  },

  // Station centroids
  stations: (feature, resolution) => {
    const state = feature.get('state')
    const isSelected = feature.get('isSelected')
    const source = '/public/images/icon-map-features-2x.png'

    // Defaults
    let anchor = [0.5, 0.75]
    let offset = [0, 0]
    let zIndex = 1

    switch (state) {
      case 21: // High
        zIndex = 6
        offset = [0, 400]
        break
      case 22: // Normal
        zIndex = 5
        offset = [0, 200]
        break
      case 24: // Error
        zIndex = 3
        offset = [0, 0]
        break
      default: // No data
        zIndex = 4
        offset = [0, 100]
    }

    // Use large symbols
    if (resolution > window.flood.maps.symbolThreshold) {
      offset[0] += 200
      anchor = [0.5, 0.5]
    }

    // Use selected symbol
    if (isSelected) {
      offset[0] += 100
    }

    const style = new Style({
      image: new Icon({
        src: source,
        size: [66, 84],
        anchor: anchor,
        scale: 0.5,
        offset: offset
      }),
      zIndex: zIndex
    })

    return style
  },

  // Impact centroids
  impacts: (feature, resolution) => {
    const isSelected = feature.get('isSelected')
    const source = '/public/images/icon-map-features-2x.png'

    // Defaults
    let anchor = [0.5, 0.75]
    let offset = [0, 500]

    // Use large symbols
    if (resolution > window.flood.maps.symbolThreshold) {
      offset[0] += 200
      anchor = [0.5, 0.5]
    }

    // Use selected symbol
    if (isSelected) {
      offset[0] += 100
    }

    const style = new Style({
      image: new Icon({
        src: source,
        size: [74, 74],
        anchor: anchor,
        scale: 0.5,
        offset: [0, 0]
      })
    })

    return style
  },

  // Rainfall centroids
  rainfall: (feature, resolution) => {
    const isSelected = feature.get('isSelected')
    const source = '/public/images/icon-map-features-2x.png'

    // Defaults
    let anchor = [0.5, 0.75]
    let offset = [0, 1500]

    // Use large symbols
    if (resolution > window.flood.maps.symbolThreshold) {
      offset[0] += 200
      anchor = [0.5, 0.5]
    }

    // Use selected symbol
    if (isSelected) {
      offset[0] += 100
    }

    const style = new Style({
      image: new Icon({
        src: source,
        size: [66, 84],
        anchor: anchor,
        scale: 0.5,
        offset: [0, 0]
      })
    })

    return style
  }
}

const pattern = (style, isSelected) => {
  const dpr = window.devicePixelRatio || 1
  const canvas = document.createElement('canvas')
  const context = canvas.getContext('2d')
  canvas.width = 8 * dpr
  canvas.height = 8 * dpr
  context.scale(dpr, dpr)
  switch (style) {
    case 'severe':
      context.fillStyle = isSelected ? '#626a6e' : '#0b0c0c'
      context.fillRect(0, 0, 8, 8)
      context.beginPath()
      context.fillStyle = '#ffffff'
      context.moveTo(0, 3.3)
      context.lineTo(4.7, 8)
      context.lineTo(3.3, 8)
      context.lineTo(0, 4.7)
      context.closePath()
      context.moveTo(3.3, 0)
      context.lineTo(4.7, 0)
      context.lineTo(8, 3.3)
      context.lineTo(8, 4.7)
      context.closePath()
      context.fill()
      break
    case 'warning':
      context.fillStyle = isSelected ? '#626a6e' : '#0b0c0c'
      context.fillRect(0, 0, 8, 8)
      context.beginPath()
      context.fillStyle = '#ffffff'
      context.moveTo(3.3, 0)
      context.lineTo(4.7, 0)
      context.lineTo(0, 4.7)
      context.lineTo(0, 3.3)
      context.closePath()
      context.moveTo(3.3, 8)
      context.lineTo(4.7, 8)
      context.lineTo(8, 4.7)
      context.lineTo(8, 3.3)
      context.closePath()
      context.moveTo(4.7, 0)
      context.lineTo(8, 3.3)
      context.lineTo(7.3, 4)
      context.lineTo(4, 0.7)
      context.closePath()
      context.moveTo(0, 4.7)
      context.lineTo(3.3, 8)
      context.lineTo(4, 7.3)
      context.lineTo(0.7, 4)
      context.closePath()
      context.fill()
      break
    case 'alert':
      context.fillStyle = '#ffffff'
      context.fillRect(0, 0, 8, 8)
      context.beginPath()
      context.fillStyle = isSelected ? '#626a6e' : '#0b0c0c'
      context.moveTo(0, 3.3)
      context.lineTo(0, 4.7)
      context.lineTo(4.7, 0)
      context.lineTo(3.3, 0)
      context.closePath()
      context.moveTo(3.3, 8)
      context.lineTo(4.7, 8)
      context.lineTo(8, 4.7)
      context.lineTo(8, 3.3)
      context.closePath()
      context.fill()
      break
    case 'removed':
      context.fillStyle = '#ffffff'
      context.fillRect(0, 0, 8, 8)
      context.beginPath()
      context.fillStyle = isSelected ? '#626a6e' : '#0b0c0c'
      context.arc(4, 4, 1, 0, 2 * Math.PI)
      context.closePath()
      context.fill()
      break
  }
  context.restore()
  return context.createPattern(canvas, 'repeat')
}
